# Area Layout Registry
# Purpose: Handle OEWS area code/title parsing and classification

version: "1.0"
description: "OEWS geographic area layout configurations for adaptive parsing"

# Header aliases for column name variations
aliases:
  code:
    - "AREA"
    - "area_code"
    - "AREA_CODE"
    - "oews_area_code"
    - "area"
    - "areaid"
    - "area_id"
  
  title:
    - "AREA_TITLE"
    - "area_title"
    - "areaname"
    - "area_name"
    - "title"
  
  area_type:
    - "AREA_TYPE"
    - "area_type"
    - "type"
  
  prim_state:
    - "PRIM_STATE"
    - "prim_state"
    - "state"
    - "state_code"

# OEWS AREA_TYPE codes mapping
oews_area_type_codes:
  "1": "NATIONAL"   # U.S. national
  "2": "STATE"      # State level
  "3": "TERRITORY"  # Guam, Puerto Rico, Virgin Islands
  "4": "MSA"        # Metropolitan Statistical Area
  "6": "NONMSA"     # Nonmetropolitan area

# Patterns for title-based classification (fallback if AREA_TYPE missing)
patterns:
  is_national_title: "(?i)^(united states|u\\.s\\.|usa|us)$"
  contains_nonmetro: "(?i)nonmetropolitan"
  msa_with_state_suffix: "(?i).+,\\s+[A-Z]{2}$"   # e.g., "Akron, OH"

# Enums for canonical values
enums:
  area_type: ["NATIONAL", "STATE", "MSA", "NONMSA", "TERRITORY"]
  metro_status: ["METRO", "NONMETRO", "NA"]

# State abbreviation to FIPS mapping
state_maps:
  abbr_to_fips:
    AL: "01"
    AK: "02"
    AZ: "04"
    AR: "05"
    CA: "06"
    CO: "08"
    CT: "09"
    DE: "10"
    DC: "11"
    FL: "12"
    GA: "13"
    HI: "15"
    ID: "16"
    IL: "17"
    IN: "18"
    IA: "19"
    KS: "20"
    KY: "21"
    LA: "22"
    ME: "23"
    MD: "24"
    MA: "25"
    MI: "26"
    MN: "27"
    MS: "28"
    MO: "29"
    MT: "30"
    NE: "31"
    NV: "32"
    NH: "33"
    NJ: "34"
    NM: "35"
    NY: "36"
    NC: "37"
    ND: "38"
    OH: "39"
    OK: "40"
    OR: "41"
    PA: "42"
    RI: "44"
    SC: "45"
    SD: "46"
    TN: "47"
    TX: "48"
    UT: "49"
    VT: "50"
    VA: "51"
    WA: "53"
    WV: "54"
    WI: "55"
    WY: "56"
  
  # Territories
  territory_abbr_to_fips:
    GU: "66"
    PR: "72"
    VI: "78"
  
  # State names for exact matching (used when PRIM_STATE not available)
  state_names:
    - Alabama
    - Alaska
    - Arizona
    - Arkansas
    - California
    - Colorado
    - Connecticut
    - Delaware
    - "District of Columbia"
    - Florida
    - Georgia
    - Hawaii
    - Idaho
    - Illinois
    - Indiana
    - Iowa
    - Kansas
    - Kentucky
    - Louisiana
    - Maine
    - Maryland
    - Massachusetts
    - Michigan
    - Minnesota
    - Mississippi
    - Missouri
    - Montana
    - Nebraska
    - Nevada
    - "New Hampshire"
    - "New Jersey"
    - "New Mexico"
    - "New York"
    - "North Carolina"
    - "North Dakota"
    - Ohio
    - Oklahoma
    - Oregon
    - Pennsylvania
    - "Rhode Island"
    - "South Carolina"
    - "South Dakota"
    - Tennessee
    - Texas
    - Utah
    - Vermont
    - Virginia
    - Washington
    - "West Virginia"
    - Wisconsin
    - Wyoming

# Validation rules
validation:
  required_fields: ["area_code", "area_title"]
  
  area_code_constraints:
    - "must be unique (primary key)"
    - "must not be null"
    - "preserve leading zeros as string"
  
  area_type_constraints:
    - "must be in enums.area_type"
  
  metro_status_constraints:
    - "must be in enums.metro_status"

# Graceful degradation rules
degradation_policy:
  missing_area_type:
    action: "attempt classification from title patterns"
    log_level: "WARNING"
  
  missing_state_info:
    action: "leave state_abbr/state_fips as null"
    log_level: "INFO"
  
  invalid_area_code:
    action: "skip row and log to resolve_me.md"
    log_level: "ERROR"
  
  duplicate_area_code:
    action: "keep latest ref_year, log to metrics"
    log_level: "WARNING"

# Priority for data sources (latest year first)
source_priority:
  - year: 2024
    location: "BLS_OEWS/2024/oews_all_data_*.{xlsx,zip}"
  - year: 2023
    location: "BLS_OEWS/2023/oews_all_data_*.{xlsx,zip}"
